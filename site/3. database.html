
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="2.%20setup.html">
      
      
        <link rel="next" href="4.%20flask_api.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>Database - Sidra Dashboard Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#database" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Sidra Dashboard Documentation" class="md-header__button md-logo" aria-label="Sidra Dashboard Documentation" data-md-component="logo">
      
  <img src="assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sidra Dashboard Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Database
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="index.html" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="2.%20setup.html" class="md-tabs__link">
      Setup
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="3.%20database.html" class="md-tabs__link md-tabs__link--active">
      Database
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="4.%20flask_api.html" class="md-tabs__link">
      Flask API Documentation
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Sidra Dashboard Documentation" class="md-nav__button md-logo" aria-label="Sidra Dashboard Documentation" data-md-component="logo">
      
  <img src="assets/images/logo.png" alt="logo">

    </a>
    Sidra Dashboard Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="2.%20setup.html" class="md-nav__link">
        Setup
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Database
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="3.%20database.html" class="md-nav__link md-nav__link--active">
        Database
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-tables" class="md-nav__link">
    The Tables
  </a>
  
    <nav class="md-nav" aria-label="The Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-1-i5" class="md-nav__link">
    Table 1: i5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-2-i7" class="md-nav__link">
    Table 2: i7
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-3-sequencer" class="md-nav__link">
    Table 3: sequencer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-4-pi_projects" class="md-nav__link">
    Table 4: pi_projects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-5-submissions" class="md-nav__link">
    Table 5: submissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-6-flowcell" class="md-nav__link">
    Table 6: flowcell
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-7-pools" class="md-nav__link">
    Table 7: pools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-type-status" class="md-nav__link">
    Custom Type: status
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-8-samples" class="md-nav__link">
    Table 8: samples
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#erd" class="md-nav__link">
    ERD
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-process" class="md-nav__link">
    The Process
  </a>
  
    <nav class="md-nav" aria-label="The Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-function" class="md-nav__link">
    main Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#store_fc-function" class="md-nav__link">
    store_fc Function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-process_1" class="md-nav__link">
    The Process:
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="4.%20flask_api.html" class="md-nav__link">
        Flask API Documentation
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="database">Database</h1>
<h2 id="overview">Overview</h2>
<p>This page provides detailed information about the PostgreSQL database schema in the platform and how it is populated. Two scripts are primarily responsible here:</p>
<ol>
<li>When the <code>database/createDB.py</code> file is executed in <a href="2.%20setup.html#v-run-the-createdbpy-script">this step</a>, the database schema is created in the PostgreSQL database.</li>
<li>When the <code>database/insertDB.py</code> file is executed in <a href="2.%20setup.html#vi-run-the-insertdbpy-script">this step</a>, it connects to the database created in the previous step, reads data from various files in specified directories (primarily from the <code>raw.info</code> files), processes this data, and inserts it into the appropriate tables in the database.</li>
</ol>
<h2 id="the-tables">The Tables</h2>
<p>Below are the schema details of the various tables in the database, along with the relevant code snippets from the <code>createDB.py</code> and <code>insertDB.py</code> scripts.</p>
<h3 id="table-1-i5">Table 1: <code>i5</code></h3>
<p>This table contains information about i5 indices, which are used in the demultiplexing process during sequencing.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Schema</label><label for="__tabbed_1_2">createDB.py</label><label for="__tabbed_1_3">insertDB.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Data Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>i5_id</td>
<td>VARCHAR(16)</td>
<td>PRIMARY KEY</td>
<td>Unique identifier for i5 index</td>
</tr>
<tr>
<td>i5_sequence</td>
<td>VARCHAR(10)</td>
<td>DEFAULT NULL, CHECK (char_length(i5_sequence) &gt;= 06)</td>
<td>The sequence of the i5 index</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE i5 (</span><span class="se">\</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="s2">      i5_id           VARCHAR(16) PRIMARY KEY,</span><span class="se">\</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="s2">      i5_sequence     VARCHAR(10) DEFAULT NULL CHECK (char_length(i5_sequence) &gt;= 06)</span><span class="se">\</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="s2">  );&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-50">50</a></span>
<span class="normal"><a href="#__codelineno-1-51">51</a></span>
<span class="normal"><a href="#__codelineno-1-52">52</a></span>
<span class="normal"><a href="#__codelineno-1-53">53</a></span>
<span class="normal"><a href="#__codelineno-1-54">54</a></span>
<span class="normal"><a href="#__codelineno-1-55">55</a></span>
<span class="normal"><a href="#__codelineno-1-56">56</a></span>
<span class="normal"><a href="#__codelineno-1-57">57</a></span>
<span class="normal"><a href="#__codelineno-1-58">58</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-50" name="__codelineno-1-50"></a><span class="c1"># table 15</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO i5 (i5_id, i5_sequence) VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;);&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I5_ID&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I5_sequencing&quot;</span><span class="p">]))</span> <span class="c1">#ON CONFLICT (i5_id) DO NOTHING</span>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="k">except</span><span class="p">:</span>
<a id="__codelineno-1-54" name="__codelineno-1-54"></a>    <span class="c1"># print(&quot;i5_sequence already exists; checking for data integrity...&quot;)</span>
<a id="__codelineno-1-55" name="__codelineno-1-55"></a>    <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT i5_sequence FROM i5 WHERE i5_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I5_ID&quot;</span><span class="p">],</span> <span class="p">))</span>
<a id="__codelineno-1-56" name="__codelineno-1-56"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-1-57" name="__codelineno-1-57"></a>    <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I5_sequencing&quot;</span><span class="p">]:</span>
<a id="__codelineno-1-58" name="__codelineno-1-58"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;entry with i5_index </span><span class="si">%s</span><span class="s2"> already exists with i5_sequence </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I5_ID&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h3 id="table-2-i7">Table 2: <code>i7</code></h3>
<p>This table contains information about i7 indices, which are also used in the demultiplexing process during sequencing.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Schema</label><label for="__tabbed_2_2">createDB.py</label><label for="__tabbed_2_3">insertDB.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Data Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>i7_id</td>
<td>VARCHAR(16)</td>
<td>PRIMARY KEY</td>
<td>Unique identifier for i7 index</td>
</tr>
<tr>
<td>i7_sequence</td>
<td>VARCHAR(10)</td>
<td>DEFAULT NULL, CHECK (char_length(i7_sequence) &gt;= 06)</td>
<td>The sequence of the i7 index</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-40">40</a></span>
<span class="normal"><a href="#__codelineno-2-41">41</a></span>
<span class="normal"><a href="#__codelineno-2-42">42</a></span>
<span class="normal"><a href="#__codelineno-2-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE i7 (</span><span class="se">\</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="s2">      i7_id           VARCHAR(16) PRIMARY KEY,</span><span class="se">\</span>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a><span class="s2">      i7_sequence     VARCHAR(10) DEFAULT NULL CHECK (char_length(i7_sequence) &gt;= 06)</span><span class="se">\</span>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="s2">  );&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-62">62</a></span>
<span class="normal"><a href="#__codelineno-3-63">63</a></span>
<span class="normal"><a href="#__codelineno-3-64">64</a></span>
<span class="normal"><a href="#__codelineno-3-65">65</a></span>
<span class="normal"><a href="#__codelineno-3-66">66</a></span>
<span class="normal"><a href="#__codelineno-3-67">67</a></span>
<span class="normal"><a href="#__codelineno-3-68">68</a></span>
<span class="normal"><a href="#__codelineno-3-69">69</a></span>
<span class="normal"><a href="#__codelineno-3-70">70</a></span>
<span class="normal"><a href="#__codelineno-3-71">71</a></span>
<span class="normal"><a href="#__codelineno-3-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-62" name="__codelineno-3-62"></a><span class="c1">#  table 17</span>
<a id="__codelineno-3-63" name="__codelineno-3-63"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-3-64" name="__codelineno-3-64"></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO i7 (i7_id, i7_sequence) VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;);&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I7_ID&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I7_sequencing&quot;</span><span class="p">]))</span> <span class="c1">#ON CONFLICT (i7_id) DO NOTHING</span>
<a id="__codelineno-3-65" name="__codelineno-3-65"></a><span class="k">except</span><span class="p">:</span>
<a id="__codelineno-3-66" name="__codelineno-3-66"></a>    <span class="c1"># print(&quot;i7_sequence already exists; checking for data integrity...&quot;)</span>
<a id="__codelineno-3-67" name="__codelineno-3-67"></a>    <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT i7_sequence FROM i7 WHERE i7_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I7_ID&quot;</span><span class="p">],</span> <span class="p">))</span>
<a id="__codelineno-3-68" name="__codelineno-3-68"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-3-69" name="__codelineno-3-69"></a>    <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I7_sequencing&quot;</span><span class="p">]:</span>
<a id="__codelineno-3-70" name="__codelineno-3-70"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;entry with i7_index </span><span class="si">%s</span><span class="s2"> already exists with i7_sequence </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I7_ID&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-3-71" name="__codelineno-3-71"></a>    <span class="c1"># else:</span>
<a id="__codelineno-3-72" name="__codelineno-3-72"></a>        <span class="c1"># print(&quot;data integrity checked for i7&quot;)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h3 id="table-3-sequencer">Table 3: <code>sequencer</code></h3>
<p>This table contains information about sequencing machines used in the lab.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:3"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><input id="__tabbed_3_3" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Schema</label><label for="__tabbed_3_2">createDB.py</label><label for="__tabbed_3_3">insertDB.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Data Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sequencer_id</td>
<td>VARCHAR(16)</td>
<td>PRIMARY KEY</td>
<td>Unique identifier for the sequencer machine</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-45">45</a></span>
<span class="normal"><a href="#__codelineno-4-46">46</a></span>
<span class="normal"><a href="#__codelineno-4-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-45" name="__codelineno-4-45"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE sequencer (</span><span class="se">\</span>
<a id="__codelineno-4-46" name="__codelineno-4-46"></a><span class="s2">      sequencer_id    VARCHAR(16) PRIMARY KEY</span><span class="se">\</span>
<a id="__codelineno-4-47" name="__codelineno-4-47"></a><span class="s2">  );&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-74">74</a></span>
<span class="normal"><a href="#__codelineno-5-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-74" name="__codelineno-5-74"></a><span class="c1"># table sequencer</span>
<a id="__codelineno-5-75" name="__codelineno-5-75"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;INSERT INTO sequencer (sequencer_id) VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;) ON CONFLICT (sequencer_id) DO NOTHING;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sequencer&quot;</span><span class="p">],</span> <span class="p">))</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h3 id="table-4-pi_projects">Table 4: <code>pi_projects</code></h3>
<p>This table contains information about different projects, including the principal investigator associated with each project and the project's requirements and timeline.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:3"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><input id="__tabbed_4_3" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Schema</label><label for="__tabbed_4_2">createDB.py</label><label for="__tabbed_4_3">insertDB.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Data Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>project_id</td>
<td>VARCHAR(32)</td>
<td>PRIMARY KEY</td>
<td>Unique identifier for the project</td>
</tr>
<tr>
<td>pi</td>
<td>VARCHAR(08)</td>
<td>NOT NULL</td>
<td>Principal Investigator responsible for the project</td>
</tr>
<tr>
<td>requirement</td>
<td>VARCHAR(32)</td>
<td>DEFAULT '_'</td>
<td>Specific requirements or goals of the project</td>
</tr>
<tr>
<td>earliest</td>
<td>DATE</td>
<td>DEFAULT NULL</td>
<td>Earliest date associated with the project (e.g., proposal date)</td>
</tr>
<tr>
<td>latest</td>
<td>DATE</td>
<td>DEFAULT NULL</td>
<td>Latest or end date associated with the project</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE pi_projects (</span><span class="se">\</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="s2">      project_id      VARCHAR(32) PRIMARY KEY,</span><span class="se">\</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="s2">      pi              VARCHAR(08) NOT NULL,</span><span class="se">\</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="s2">      requirement     VARCHAR(32) DEFAULT &#39;_&#39;,</span><span class="se">\</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="s2">      earliest        DATE DEFAULT NULL,</span><span class="se">\</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="s2">      latest          DATE DEFAULT NULL</span><span class="se">\</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="s2">  );&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-77">77</a></span>
<span class="normal"><a href="#__codelineno-7-78">78</a></span>
<span class="normal"><a href="#__codelineno-7-79">79</a></span>
<span class="normal"><a href="#__codelineno-7-80">80</a></span>
<span class="normal"><a href="#__codelineno-7-81">81</a></span>
<span class="normal"><a href="#__codelineno-7-82">82</a></span>
<span class="normal"><a href="#__codelineno-7-83">83</a></span>
<span class="normal"><a href="#__codelineno-7-84">84</a></span>
<span class="normal"><a href="#__codelineno-7-85">85</a></span>
<span class="normal"><a href="#__codelineno-7-86">86</a></span>
<span class="normal"><a href="#__codelineno-7-87">87</a></span>
<span class="normal"><a href="#__codelineno-7-88">88</a></span>
<span class="normal"><a href="#__codelineno-7-89">89</a></span>
<span class="normal"><a href="#__codelineno-7-90">90</a></span>
<span class="normal"><a href="#__codelineno-7-91">91</a></span>
<span class="normal"><a href="#__codelineno-7-92">92</a></span>
<span class="normal"><a href="#__codelineno-7-93">93</a></span>
<span class="normal"><a href="#__codelineno-7-94">94</a></span>
<span class="normal"><a href="#__codelineno-7-95">95</a></span>
<span class="normal"><a href="#__codelineno-7-96">96</a></span>
<span class="normal"><a href="#__codelineno-7-97">97</a></span>
<span class="normal"><a href="#__codelineno-7-98">98</a></span>
<span class="normal"><a href="#__codelineno-7-99">99</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-77" name="__codelineno-7-77"></a><span class="c1"># table pi_projects</span>
<a id="__codelineno-7-78" name="__codelineno-7-78"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-7-79" name="__codelineno-7-79"></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO pi_projects (project_id, pi, requirement) VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;);&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Project&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PI&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Data Requirement&quot;</span><span class="p">]))</span>
<a id="__codelineno-7-80" name="__codelineno-7-80"></a><span class="k">except</span><span class="p">:</span>
<a id="__codelineno-7-81" name="__codelineno-7-81"></a>    <span class="c1"># print(&quot;pi, project pair already exists; checking for data integrity...&quot;)</span>
<a id="__codelineno-7-82" name="__codelineno-7-82"></a>    <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT requirement FROM pi_projects WHERE project_id = &#39;</span><span class="si">%s</span><span class="s2">&#39; AND pi = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Project&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PI&quot;</span><span class="p">]))</span>
<a id="__codelineno-7-83" name="__codelineno-7-83"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-7-84" name="__codelineno-7-84"></a>    <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Data Requirement&quot;</span><span class="p">]:</span>
<a id="__codelineno-7-85" name="__codelineno-7-85"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data requirement changed for project </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Project&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Data Requirement&quot;</span><span class="p">]))</span>
<a id="__codelineno-7-86" name="__codelineno-7-86"></a>    <span class="c1"># else:</span>
<a id="__codelineno-7-87" name="__codelineno-7-87"></a>        <span class="c1"># print(&quot;data integrity checked for pi_project&quot;)</span>
<a id="__codelineno-7-88" name="__codelineno-7-88"></a>
<a id="__codelineno-7-89" name="__codelineno-7-89"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT earliest, latest FROM pi_projects WHERE project_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Project&quot;</span><span class="p">]))</span>
<a id="__codelineno-7-90" name="__codelineno-7-90"></a><span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-7-91" name="__codelineno-7-91"></a>
<a id="__codelineno-7-92" name="__codelineno-7-92"></a><span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-7-93" name="__codelineno-7-93"></a>    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-7-94" name="__codelineno-7-94"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission Date&quot;</span><span class="p">]:</span>
<a id="__codelineno-7-95" name="__codelineno-7-95"></a>        <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE pi_projects SET earliest = &#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE project_id = &#39;</span><span class="si">%s</span><span class="s2">&#39; AND pi = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission Date&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Project&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PI&quot;</span><span class="p">]))</span>
<a id="__codelineno-7-96" name="__codelineno-7-96"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission Date&quot;</span><span class="p">]:</span>
<a id="__codelineno-7-97" name="__codelineno-7-97"></a>        <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE pi_projects SET latest = &#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE project_id = &#39;</span><span class="si">%s</span><span class="s2">&#39; AND pi = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission Date&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Project&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PI&quot;</span><span class="p">]))</span>
<a id="__codelineno-7-98" name="__codelineno-7-98"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-99" name="__codelineno-7-99"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;date fetch failed&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h3 id="table-5-submissions">Table 5: <code>submissions</code></h3>
<p>This table contains information about project submissions, including the associated project, date of submission, and various metadata related to the sequencing process.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:3"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><input id="__tabbed_5_3" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Schema</label><label for="__tabbed_5_2">createDB.py</label><label for="__tabbed_5_3">insertDB.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Data Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>submission_id</td>
<td>VARCHAR(64)</td>
<td>PRIMARY KEY</td>
<td>Unique identifier for submission</td>
</tr>
<tr>
<td>project_id</td>
<td>VARCHAR(32)</td>
<td>REFERENCES pi_projects (project_id)</td>
<td>Linked project ID</td>
</tr>
<tr>
<td>date</td>
<td>DATE</td>
<td>NOT NULL, CHECK (date &lt;= current_date)</td>
<td>Date when the samples were submitted for sequencing</td>
</tr>
<tr>
<td>cov</td>
<td>VARCHAR(16)</td>
<td>DEFAULT '_'</td>
<td>Coverage target for sequencing (e.g., 100x)</td>
</tr>
<tr>
<td>srv</td>
<td>VARCHAR(16)</td>
<td>DEFAULT '_'</td>
<td>Type of sequencing service requested (e.g., Whole Genome, RNA-Seq)</td>
</tr>
<tr>
<td>rg</td>
<td>VARCHAR(16)</td>
<td>DEFAULT '_'</td>
<td>Read Group information for BAM file header</td>
</tr>
<tr>
<td>anl</td>
<td>VARCHAR(16)</td>
<td>DEFAULT '_'</td>
<td>Type of analysis to be performed on the data (e.g., Variant Calling)</td>
</tr>
<tr>
<td>datatype</td>
<td>VARCHAR(16)</td>
<td>NOT NULL</td>
<td>Type of data (e.g., DNA, RNA)</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-49">49</a></span>
<span class="normal"><a href="#__codelineno-8-50">50</a></span>
<span class="normal"><a href="#__codelineno-8-51">51</a></span>
<span class="normal"><a href="#__codelineno-8-52">52</a></span>
<span class="normal"><a href="#__codelineno-8-53">53</a></span>
<span class="normal"><a href="#__codelineno-8-54">54</a></span>
<span class="normal"><a href="#__codelineno-8-55">55</a></span>
<span class="normal"><a href="#__codelineno-8-56">56</a></span>
<span class="normal"><a href="#__codelineno-8-57">57</a></span>
<span class="normal"><a href="#__codelineno-8-58">58</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-49" name="__codelineno-8-49"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE submissions (</span><span class="se">\</span>
<a id="__codelineno-8-50" name="__codelineno-8-50"></a><span class="s2">      submission_id   VARCHAR(64) PRIMARY KEY,</span><span class="se">\</span>
<a id="__codelineno-8-51" name="__codelineno-8-51"></a><span class="s2">      project_id      VARCHAR(32) REFERENCES pi_projects (project_id),</span><span class="se">\</span>
<a id="__codelineno-8-52" name="__codelineno-8-52"></a><span class="s2">      date            DATE NOT NULL CHECK (date &lt;= current_date),</span><span class="se">\</span>
<a id="__codelineno-8-53" name="__codelineno-8-53"></a><span class="s2">      cov             VARCHAR(16) DEFAULT &#39;_&#39;,</span><span class="se">\</span>
<a id="__codelineno-8-54" name="__codelineno-8-54"></a><span class="s2">      srv             VARCHAR(16) DEFAULT &#39;_&#39;,</span><span class="se">\</span>
<a id="__codelineno-8-55" name="__codelineno-8-55"></a><span class="s2">      rg              VARCHAR(16) DEFAULT &#39;_&#39;,</span><span class="se">\</span>
<a id="__codelineno-8-56" name="__codelineno-8-56"></a><span class="s2">      anl             VARCHAR(16) DEFAULT &#39;_&#39;,</span><span class="se">\</span>
<a id="__codelineno-8-57" name="__codelineno-8-57"></a><span class="s2">      datatype        VARCHAR(16) NOT NULL</span><span class="se">\</span>
<a id="__codelineno-8-58" name="__codelineno-8-58"></a><span class="s2">  );&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-101">101</a></span>
<span class="normal"><a href="#__codelineno-9-102">102</a></span>
<span class="normal"><a href="#__codelineno-9-103">103</a></span>
<span class="normal"><a href="#__codelineno-9-104">104</a></span>
<span class="normal"><a href="#__codelineno-9-105">105</a></span>
<span class="normal"><a href="#__codelineno-9-106">106</a></span>
<span class="normal"><a href="#__codelineno-9-107">107</a></span>
<span class="normal"><a href="#__codelineno-9-108">108</a></span>
<span class="normal"><a href="#__codelineno-9-109">109</a></span>
<span class="normal"><a href="#__codelineno-9-110">110</a></span>
<span class="normal"><a href="#__codelineno-9-111">111</a></span>
<span class="normal"><a href="#__codelineno-9-112">112</a></span>
<span class="normal"><a href="#__codelineno-9-113">113</a></span>
<span class="normal"><a href="#__codelineno-9-114">114</a></span>
<span class="normal"><a href="#__codelineno-9-115">115</a></span>
<span class="normal"><a href="#__codelineno-9-116">116</a></span>
<span class="normal"><a href="#__codelineno-9-117">117</a></span>
<span class="normal"><a href="#__codelineno-9-118">118</a></span>
<span class="normal"><a href="#__codelineno-9-119">119</a></span>
<span class="normal"><a href="#__codelineno-9-120">120</a></span>
<span class="normal"><a href="#__codelineno-9-121">121</a></span>
<span class="normal"><a href="#__codelineno-9-122">122</a></span>
<span class="normal"><a href="#__codelineno-9-123">123</a></span>
<span class="normal"><a href="#__codelineno-9-124">124</a></span>
<span class="normal"><a href="#__codelineno-9-125">125</a></span>
<span class="normal"><a href="#__codelineno-9-126">126</a></span>
<span class="normal"><a href="#__codelineno-9-127">127</a></span>
<span class="normal"><a href="#__codelineno-9-128">128</a></span>
<span class="normal"><a href="#__codelineno-9-129">129</a></span>
<span class="normal"><a href="#__codelineno-9-130">130</a></span>
<span class="normal"><a href="#__codelineno-9-131">131</a></span>
<span class="normal"><a href="#__codelineno-9-132">132</a></span>
<span class="normal"><a href="#__codelineno-9-133">133</a></span>
<span class="normal"><a href="#__codelineno-9-134">134</a></span>
<span class="normal"><a href="#__codelineno-9-135">135</a></span>
<span class="normal"><a href="#__codelineno-9-136">136</a></span>
<span class="normal"><a href="#__codelineno-9-137">137</a></span>
<span class="normal"><a href="#__codelineno-9-138">138</a></span>
<span class="normal"><a href="#__codelineno-9-139">139</a></span>
<span class="normal"><a href="#__codelineno-9-140">140</a></span>
<span class="normal"><a href="#__codelineno-9-141">141</a></span>
<span class="normal"><a href="#__codelineno-9-142">142</a></span>
<span class="normal"><a href="#__codelineno-9-143">143</a></span>
<span class="normal"><a href="#__codelineno-9-144">144</a></span>
<span class="normal"><a href="#__codelineno-9-145">145</a></span>
<span class="normal"><a href="#__codelineno-9-146">146</a></span>
<span class="normal"><a href="#__codelineno-9-147">147</a></span>
<span class="normal"><a href="#__codelineno-9-148">148</a></span>
<span class="normal"><a href="#__codelineno-9-149">149</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-101" name="__codelineno-9-101"></a><span class="c1">#  table submissions</span>
<a id="__codelineno-9-102" name="__codelineno-9-102"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-9-103" name="__codelineno-9-103"></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO submissions (submission_id, project_id, date, datatype) VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;);&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Project&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission Date&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Datatype&quot;</span><span class="p">]))</span>
<a id="__codelineno-9-104" name="__codelineno-9-104"></a><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-9-105" name="__codelineno-9-105"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;duplicate key value violates&quot;</span><span class="p">):</span>
<a id="__codelineno-9-106" name="__codelineno-9-106"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-9-107" name="__codelineno-9-107"></a>    <span class="c1"># print(&quot;submission_id already exists; checking for data integrity...&quot;)</span>
<a id="__codelineno-9-108" name="__codelineno-9-108"></a>
<a id="__codelineno-9-109" name="__codelineno-9-109"></a>
<a id="__codelineno-9-110" name="__codelineno-9-110"></a><span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Comments&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-9-111" name="__codelineno-9-111"></a>    <span class="n">comments</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Comments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<a id="__codelineno-9-112" name="__codelineno-9-112"></a>    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-9-113" name="__codelineno-9-113"></a>    <span class="n">sid</span> <span class="o">=</span> <span class="n">comments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<a id="__codelineno-9-114" name="__codelineno-9-114"></a>    <span class="n">srv</span> <span class="o">=</span> <span class="n">comments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<a id="__codelineno-9-115" name="__codelineno-9-115"></a>    <span class="n">rg</span> <span class="o">=</span> <span class="n">comments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<a id="__codelineno-9-116" name="__codelineno-9-116"></a>    <span class="n">cov</span> <span class="o">=</span> <span class="n">comments</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<a id="__codelineno-9-117" name="__codelineno-9-117"></a>    <span class="n">anl</span> <span class="o">=</span> <span class="n">comments</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<a id="__codelineno-9-118" name="__codelineno-9-118"></a>
<a id="__codelineno-9-119" name="__codelineno-9-119"></a>    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">sid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SUB&quot;</span><span class="p">))</span>
<a id="__codelineno-9-120" name="__codelineno-9-120"></a>    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">srv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">srv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">srv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SRV&quot;</span><span class="p">))</span>
<a id="__codelineno-9-121" name="__codelineno-9-121"></a>    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">rg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;RG&quot;</span><span class="p">))</span>
<a id="__codelineno-9-122" name="__codelineno-9-122"></a>    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;COV&quot;</span><span class="p">))</span>
<a id="__codelineno-9-123" name="__codelineno-9-123"></a>    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">anl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">anl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">anl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ANL&quot;</span><span class="p">))</span>
<a id="__codelineno-9-124" name="__codelineno-9-124"></a>    <span class="k">assert</span><span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">])</span>
<a id="__codelineno-9-125" name="__codelineno-9-125"></a>
<a id="__codelineno-9-126" name="__codelineno-9-126"></a>    <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT srv, rg, cov, anl FROM submissions WHERE submission_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-9-127" name="__codelineno-9-127"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-9-128" name="__codelineno-9-128"></a>    <span class="c1"># if data != None:</span>
<a id="__codelineno-9-129" name="__codelineno-9-129"></a>        <span class="c1"># assert(len(data) == 4)</span>
<a id="__codelineno-9-130" name="__codelineno-9-130"></a>
<a id="__codelineno-9-131" name="__codelineno-9-131"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">srv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-9-132" name="__codelineno-9-132"></a>        <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE submissions SET srv = &#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE submission_id = &#39;</span><span class="si">%s</span><span class="s2">&#39; ;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">srv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-9-133" name="__codelineno-9-133"></a>    <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">srv</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-9-134" name="__codelineno-9-134"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;service data changed for submission id &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">srv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-9-135" name="__codelineno-9-135"></a>
<a id="__codelineno-9-136" name="__codelineno-9-136"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-9-137" name="__codelineno-9-137"></a>        <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE submissions SET rg = &#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE submission_id = &#39;</span><span class="si">%s</span><span class="s2">&#39; ;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">rg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-9-138" name="__codelineno-9-138"></a>    <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">rg</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-9-139" name="__codelineno-9-139"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ref_genome data changed for submission id &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rg</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-9-140" name="__codelineno-9-140"></a>
<a id="__codelineno-9-141" name="__codelineno-9-141"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-9-142" name="__codelineno-9-142"></a>        <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE submissions SET cov = &#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE submission_id = &#39;</span><span class="si">%s</span><span class="s2">&#39; ;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-9-143" name="__codelineno-9-143"></a>    <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-9-144" name="__codelineno-9-144"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;coverage data changed for submission id &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-9-145" name="__codelineno-9-145"></a>
<a id="__codelineno-9-146" name="__codelineno-9-146"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">anl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-9-147" name="__codelineno-9-147"></a>        <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE submissions SET anl = &#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE submission_id = &#39;</span><span class="si">%s</span><span class="s2">&#39; ;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">anl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-9-148" name="__codelineno-9-148"></a>    <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="n">anl</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-9-149" name="__codelineno-9-149"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;analysis data changed for submission id &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">anl</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h3 id="table-6-flowcell">Table 6: <code>flowcell</code></h3>
<p>This table contains detailed information about flowcells used in sequencing, including the type of flowcell, who loaded it, and various dates associated with the sequencing process.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:3"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><input id="__tabbed_6_3" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Schema</label><label for="__tabbed_6_2">createDB.py</label><label for="__tabbed_6_3">insertDB.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Data Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>fc_id</td>
<td>VARCHAR(16)</td>
<td>PRIMARY KEY</td>
<td>Unique identifier for flowcell</td>
</tr>
<tr>
<td>fc_type</td>
<td>VARCHAR(16)</td>
<td>NOT NULL, CHECK (char_length(fc_type) &gt; 0)</td>
<td>Type of flowcell (e.g., NovaSeq S4)</td>
</tr>
<tr>
<td>loaded_by</td>
<td>VARCHAR(08)</td>
<td>NOT NULL, CHECK (char_length(loaded_by) &gt; 0)</td>
<td>Lab member who loaded the flowcell onto the sequencer</td>
</tr>
<tr>
<td>loading_date</td>
<td>DATE</td>
<td>NOT NULL, CHECK (loading_date &lt;= current_date)</td>
<td>Date when the flowcell was loaded onto the sequencer</td>
</tr>
<tr>
<td>completion_date</td>
<td>DATE</td>
<td>NOT NULL, CHECK (completion_date &lt;= current_date), CHECK (completion_date &gt;= loading_date)</td>
<td>Date when the sequencing run was completed</td>
</tr>
<tr>
<td>demultiplex_date</td>
<td>DATE</td>
<td>NOT NULL, CHECK (demultiplex_date &lt;= current_date)</td>
<td>Date when the demultiplexing was completed</td>
</tr>
<tr>
<td>stage_date</td>
<td>DATE</td>
<td>DEFAULT NULL, CHECK (stage_date &lt;= current_date)</td>
<td>Date when the data was staged for analysis</td>
</tr>
<tr>
<td>process_date</td>
<td>DATE</td>
<td>DEFAULT NULL, CHECK (process_date &lt;= current_date)</td>
<td>Date when the data processing was completed</td>
</tr>
<tr>
<td>order_no</td>
<td>VARCHAR(32)</td>
<td>NOT NULL, CHECK (char_length(order_no) &gt; 0)</td>
<td>Order or batch number associated with the sequencing run</td>
</tr>
<tr>
<td>sequencer_id</td>
<td>VARCHAR(16)</td>
<td>REFERENCES sequencer (sequencer_id)</td>
<td>Linked sequencer ID</td>
</tr>
<tr>
<td>run_duration</td>
<td>SMALLINT</td>
<td>CHECK ((run_duration ISNULL) OR (run_duration &gt; 0)) DEFAULT NULL</td>
<td>Duration of the sequencing run in hours</td>
</tr>
<tr>
<td>position</td>
<td>BOOLEAN</td>
<td>NOT NULL</td>
<td>Position of the flowcell on the sequencer (e.g., left or right)</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-61">61</a></span>
<span class="normal"><a href="#__codelineno-10-62">62</a></span>
<span class="normal"><a href="#__codelineno-10-63">63</a></span>
<span class="normal"><a href="#__codelineno-10-64">64</a></span>
<span class="normal"><a href="#__codelineno-10-65">65</a></span>
<span class="normal"><a href="#__codelineno-10-66">66</a></span>
<span class="normal"><a href="#__codelineno-10-67">67</a></span>
<span class="normal"><a href="#__codelineno-10-68">68</a></span>
<span class="normal"><a href="#__codelineno-10-69">69</a></span>
<span class="normal"><a href="#__codelineno-10-70">70</a></span>
<span class="normal"><a href="#__codelineno-10-71">71</a></span>
<span class="normal"><a href="#__codelineno-10-72">72</a></span>
<span class="normal"><a href="#__codelineno-10-73">73</a></span>
<span class="normal"><a href="#__codelineno-10-74">74</a></span>
<span class="normal"><a href="#__codelineno-10-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-61" name="__codelineno-10-61"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE flowcell (</span><span class="se">\</span>
<a id="__codelineno-10-62" name="__codelineno-10-62"></a><span class="s2">      fc_id           VARCHAR(16) PRIMARY KEY,</span><span class="se">\</span>
<a id="__codelineno-10-63" name="__codelineno-10-63"></a><span class="s2">      fc_type         VARCHAR(16) NOT NULL CHECK (char_length(fc_type) &gt; 0),</span><span class="se">\</span>
<a id="__codelineno-10-64" name="__codelineno-10-64"></a><span class="s2">      loaded_by       VARCHAR(08) NOT NULL CHECK (char_length(loaded_by) &gt; 0),</span><span class="se">\</span>
<a id="__codelineno-10-65" name="__codelineno-10-65"></a><span class="s2">      loading_date    DATE     NOT NULL CHECK (loading_date &lt;= current_date),</span><span class="se">\</span>
<a id="__codelineno-10-66" name="__codelineno-10-66"></a><span class="s2">      completion_date DATE     NOT NULL CHECK (completion_date &lt;= current_date),</span><span class="se">\</span>
<a id="__codelineno-10-67" name="__codelineno-10-67"></a><span class="s2">      demultiplex_date DATE    NOT NULL CHECK (demultiplex_date &lt;= current_date),</span><span class="se">\</span>
<a id="__codelineno-10-68" name="__codelineno-10-68"></a><span class="s2">      stage_date       DATE    DEFAULT NULL CHECK (stage_date &lt;= current_date),</span><span class="se">\</span>
<a id="__codelineno-10-69" name="__codelineno-10-69"></a><span class="s2">      process_date     DATE    DEFAULT NULL CHECK (process_date &lt;= current_date),</span><span class="se">\</span>
<a id="__codelineno-10-70" name="__codelineno-10-70"></a><span class="s2">      order_no        VARCHAR(32) NOT NULL CHECK (char_length(order_no) &gt; 0),</span><span class="se">\</span>
<a id="__codelineno-10-71" name="__codelineno-10-71"></a><span class="s2">      sequencer_id    VARCHAR(16) REFERENCES sequencer (sequencer_id),</span><span class="se">\</span>
<a id="__codelineno-10-72" name="__codelineno-10-72"></a><span class="s2">      run_duration    SMALLINT CHECK ((run_duration ISNULL) OR (run_duration &gt; 0)) DEFAULT NULL,</span><span class="se">\</span>
<a id="__codelineno-10-73" name="__codelineno-10-73"></a><span class="s2">      position        BOOLEAN NOT NULL,</span><span class="se">\</span>
<a id="__codelineno-10-74" name="__codelineno-10-74"></a><span class="s2">      CHECK (completion_date &gt;= loading_date)</span><span class="se">\</span>
<a id="__codelineno-10-75" name="__codelineno-10-75"></a><span class="s2">  );&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-172">172</a></span>
<span class="normal"><a href="#__codelineno-11-173">173</a></span>
<span class="normal"><a href="#__codelineno-11-174">174</a></span>
<span class="normal"><a href="#__codelineno-11-175">175</a></span>
<span class="normal"><a href="#__codelineno-11-176">176</a></span>
<span class="normal"><a href="#__codelineno-11-177">177</a></span>
<span class="normal"><a href="#__codelineno-11-178">178</a></span>
<span class="normal"><a href="#__codelineno-11-179">179</a></span>
<span class="normal"><a href="#__codelineno-11-180">180</a></span>
<span class="normal"><a href="#__codelineno-11-181">181</a></span>
<span class="normal"><a href="#__codelineno-11-182">182</a></span>
<span class="normal"><a href="#__codelineno-11-183">183</a></span>
<span class="normal"><a href="#__codelineno-11-184">184</a></span>
<span class="normal"><a href="#__codelineno-11-185">185</a></span>
<span class="normal"><a href="#__codelineno-11-186">186</a></span>
<span class="normal"><a href="#__codelineno-11-187">187</a></span>
<span class="normal"><a href="#__codelineno-11-188">188</a></span>
<span class="normal"><a href="#__codelineno-11-189">189</a></span>
<span class="normal"><a href="#__codelineno-11-190">190</a></span>
<span class="normal"><a href="#__codelineno-11-191">191</a></span>
<span class="normal"><a href="#__codelineno-11-192">192</a></span>
<span class="normal"><a href="#__codelineno-11-193">193</a></span>
<span class="normal"><a href="#__codelineno-11-194">194</a></span>
<span class="normal"><a href="#__codelineno-11-195">195</a></span>
<span class="normal"><a href="#__codelineno-11-196">196</a></span>
<span class="normal"><a href="#__codelineno-11-197">197</a></span>
<span class="normal"><a href="#__codelineno-11-198">198</a></span>
<span class="normal"><a href="#__codelineno-11-199">199</a></span>
<span class="normal"><a href="#__codelineno-11-200">200</a></span>
<span class="normal"><a href="#__codelineno-11-201">201</a></span>
<span class="normal"><a href="#__codelineno-11-202">202</a></span>
<span class="normal"><a href="#__codelineno-11-203">203</a></span>
<span class="normal"><a href="#__codelineno-11-204">204</a></span>
<span class="normal"><a href="#__codelineno-11-205">205</a></span>
<span class="normal"><a href="#__codelineno-11-206">206</a></span>
<span class="normal"><a href="#__codelineno-11-207">207</a></span>
<span class="normal"><a href="#__codelineno-11-208">208</a></span>
<span class="normal"><a href="#__codelineno-11-209">209</a></span>
<span class="normal"><a href="#__codelineno-11-210">210</a></span>
<span class="normal"><a href="#__codelineno-11-211">211</a></span>
<span class="normal"><a href="#__codelineno-11-212">212</a></span>
<span class="normal"><a href="#__codelineno-11-213">213</a></span>
<span class="normal"><a href="#__codelineno-11-214">214</a></span>
<span class="normal"><a href="#__codelineno-11-215">215</a></span>
<span class="normal"><a href="#__codelineno-11-216">216</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-172" name="__codelineno-11-172"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-11-173" name="__codelineno-11-173"></a>    <span class="c1"># print(row[&quot;Completion Date&quot;])</span>
<a id="__codelineno-11-174" name="__codelineno-11-174"></a>    <span class="c1"># print(row)</span>
<a id="__codelineno-11-175" name="__codelineno-11-175"></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO flowcell (fc_id, fc_type, loaded_by, loading_date, completion_date, demultiplex_date, order_no, sequencer_id, position)</span><span class="se">\</span>
<a id="__codelineno-11-176" name="__codelineno-11-176"></a><span class="s2">    VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;);&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC Type&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Loaded By&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Loading Date&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Completion Date&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Demultiplex Date&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Order No&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sequencer&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Position&quot;</span><span class="p">]))</span>
<a id="__codelineno-11-177" name="__codelineno-11-177"></a>
<a id="__codelineno-11-178" name="__codelineno-11-178"></a><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-11-179" name="__codelineno-11-179"></a>    <span class="c1"># print(e)</span>
<a id="__codelineno-11-180" name="__codelineno-11-180"></a>    <span class="c1"># print(row[&quot;Completion Date&quot;])</span>
<a id="__codelineno-11-181" name="__codelineno-11-181"></a>    <span class="c1"># print(row)</span>
<a id="__codelineno-11-182" name="__codelineno-11-182"></a>    <span class="c1"># print(&quot;flowcell already exists; checking for data integrity...&quot;)</span>
<a id="__codelineno-11-183" name="__codelineno-11-183"></a>    <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT fc_type, loaded_by, loading_date, completion_date, demultiplex_date, order_no, sequencer_id, position FROM flowcell WHERE fc_id = &#39;</span><span class="si">%s</span><span class="s2">&#39; ;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">]))</span> <span class="c1"># try except data integrity</span>
<a id="__codelineno-11-184" name="__codelineno-11-184"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-11-185" name="__codelineno-11-185"></a>    <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-11-186" name="__codelineno-11-186"></a>        <span class="c1"># print(data)</span>
<a id="__codelineno-11-187" name="__codelineno-11-187"></a>        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-11-188" name="__codelineno-11-188"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-11-189" name="__codelineno-11-189"></a>            <span class="n">loading_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Loading Date&quot;</span><span class="p">],</span> <span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<a id="__codelineno-11-190" name="__codelineno-11-190"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-11-191" name="__codelineno-11-191"></a>            <span class="n">loading_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Loading Date&quot;</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<a id="__codelineno-11-192" name="__codelineno-11-192"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-11-193" name="__codelineno-11-193"></a>            <span class="n">completion_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Completion Date&quot;</span><span class="p">],</span> <span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<a id="__codelineno-11-194" name="__codelineno-11-194"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-11-195" name="__codelineno-11-195"></a>            <span class="n">completion_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Completion Date&quot;</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<a id="__codelineno-11-196" name="__codelineno-11-196"></a>        <span class="c1"># demultiplex_date = datetime.datetime.strptime(row[&quot;Demultiplex Date&quot;, ])</span>
<a id="__codelineno-11-197" name="__codelineno-11-197"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC Type&quot;</span><span class="p">]:</span>
<a id="__codelineno-11-198" name="__codelineno-11-198"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FC Type data changed for flowcell </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC Type&quot;</span><span class="p">]))</span>
<a id="__codelineno-11-199" name="__codelineno-11-199"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Loaded By&quot;</span><span class="p">]:</span>
<a id="__codelineno-11-200" name="__codelineno-11-200"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded By data changed for flowcell </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Loaded By&quot;</span><span class="p">]))</span>
<a id="__codelineno-11-201" name="__codelineno-11-201"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">loading_date</span><span class="p">:</span>
<a id="__codelineno-11-202" name="__codelineno-11-202"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading Date data changed for flowcell </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">loading_date</span><span class="p">))</span>
<a id="__codelineno-11-203" name="__codelineno-11-203"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="n">completion_date</span><span class="p">:</span>
<a id="__codelineno-11-204" name="__codelineno-11-204"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Completed Date data changed for flowcell </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">completion_date</span><span class="p">))</span>
<a id="__codelineno-11-205" name="__codelineno-11-205"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Demultiplex Date&quot;</span><span class="p">]:</span>
<a id="__codelineno-11-206" name="__codelineno-11-206"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Demultiplex Date data changed for flowcell </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Demultiplex Date&quot;</span><span class="p">]))</span>
<a id="__codelineno-11-207" name="__codelineno-11-207"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Order No&quot;</span><span class="p">]:</span>
<a id="__codelineno-11-208" name="__codelineno-11-208"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Order No data changed for flowcell </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Order No&quot;</span><span class="p">]))</span>
<a id="__codelineno-11-209" name="__codelineno-11-209"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sequencer&quot;</span><span class="p">]:</span>
<a id="__codelineno-11-210" name="__codelineno-11-210"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sequencer data changed for flowcell </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sequencer&quot;</span><span class="p">]))</span>
<a id="__codelineno-11-211" name="__codelineno-11-211"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Position&quot;</span><span class="p">]:</span>
<a id="__codelineno-11-212" name="__codelineno-11-212"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;position data changed for flowcell </span><span class="si">%s</span><span class="s2"> from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Position&quot;</span><span class="p">]))</span>
<a id="__codelineno-11-213" name="__codelineno-11-213"></a>
<a id="__codelineno-11-214" name="__codelineno-11-214"></a>
<a id="__codelineno-11-215" name="__codelineno-11-215"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-11-216" name="__codelineno-11-216"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;flowcell data fetch failed&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h3 id="table-7-pools">Table 7: <code>pools</code></h3>
<p>This table contains information about pooled samples, which are mixtures of multiple samples that are sequenced together in a single lane of a flowcell.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:3"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><input id="__tabbed_7_3" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">Schema</label><label for="__tabbed_7_2">createDB.py</label><label for="__tabbed_7_3">insertDB.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Data Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>pooling_id</td>
<td>VARCHAR(32)</td>
<td>PRIMARY KEY</td>
<td>Unique identifier for pooling</td>
</tr>
<tr>
<td>pf_reads</td>
<td>VARCHAR(08)</td>
<td>NOT NULL</td>
<td>Number of pass filter reads obtained from sequencing</td>
</tr>
<tr>
<td>loading_conc</td>
<td>VARCHAR(08)</td>
<td>NOT NULL</td>
<td>Concentration of the pooled sample loaded onto the flowcell</td>
</tr>
<tr>
<td>q30</td>
<td>NUMERIC(5, 3)</td>
<td>NOT NULL, CHECK ((q30 &gt;= 0) AND (q30 &lt;= 100))</td>
<td>Percentage of bases with a Q30 quality score</td>
</tr>
<tr>
<td>lane_1</td>
<td>BOOLEAN</td>
<td>NOT NULL, DEFAULT FALSE</td>
<td>Indicates whether the pool was sequenced in lane 1</td>
</tr>
<tr>
<td>lane_2</td>
<td>BOOLEAN</td>
<td>NOT NULL, DEFAULT FALSE</td>
<td>Indicates whether the pool was sequenced in lane 2</td>
</tr>
<tr>
<td>lane_3</td>
<td>BOOLEAN</td>
<td>NOT NULL, DEFAULT FALSE</td>
<td>Indicates whether the pool was sequenced in lane 3</td>
</tr>
<tr>
<td>lane_4</td>
<td>BOOLEAN</td>
<td>NOT NULL, DEFAULT FALSE</td>
<td>Indicates whether the pool was sequenced in lane 4</td>
</tr>
<tr>
<td>fc_id</td>
<td>VARCHAR(16)</td>
<td>REFERENCES flowcell (fc_id)</td>
<td>Linked flowcell ID</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-77">77</a></span>
<span class="normal"><a href="#__codelineno-12-78">78</a></span>
<span class="normal"><a href="#__codelineno-12-79">79</a></span>
<span class="normal"><a href="#__codelineno-12-80">80</a></span>
<span class="normal"><a href="#__codelineno-12-81">81</a></span>
<span class="normal"><a href="#__codelineno-12-82">82</a></span>
<span class="normal"><a href="#__codelineno-12-83">83</a></span>
<span class="normal"><a href="#__codelineno-12-84">84</a></span>
<span class="normal"><a href="#__codelineno-12-85">85</a></span>
<span class="normal"><a href="#__codelineno-12-86">86</a></span>
<span class="normal"><a href="#__codelineno-12-87">87</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-77" name="__codelineno-12-77"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE pools (</span><span class="se">\</span>
<a id="__codelineno-12-78" name="__codelineno-12-78"></a><span class="s2">      pooling_id      VARCHAR(32) PRIMARY KEY,</span><span class="se">\</span>
<a id="__codelineno-12-79" name="__codelineno-12-79"></a><span class="s2">      pf_reads        VARCHAR(08) NOT NULL,</span><span class="se">\</span>
<a id="__codelineno-12-80" name="__codelineno-12-80"></a><span class="s2">      loading_conc    VARCHAR(08) NOT NULL,</span><span class="se">\</span>
<a id="__codelineno-12-81" name="__codelineno-12-81"></a><span class="s2">      q30             NUMERIC(5, 3) NOT NULL CHECK ((q30 &gt;= 0) AND (q30 &lt;= 100)),</span><span class="se">\</span>
<a id="__codelineno-12-82" name="__codelineno-12-82"></a><span class="s2">      lane_1          BOOLEAN  NOT NULL DEFAULT FALSE,</span><span class="se">\</span>
<a id="__codelineno-12-83" name="__codelineno-12-83"></a><span class="s2">      lane_2          BOOLEAN  NOT NULL DEFAULT FALSE,</span><span class="se">\</span>
<a id="__codelineno-12-84" name="__codelineno-12-84"></a><span class="s2">      lane_3          BOOLEAN  NOT NULL DEFAULT FALSE,</span><span class="se">\</span>
<a id="__codelineno-12-85" name="__codelineno-12-85"></a><span class="s2">      lane_4          BOOLEAN  NOT NULL DEFAULT FALSE,</span><span class="se">\</span>
<a id="__codelineno-12-86" name="__codelineno-12-86"></a><span class="s2">      fc_id           VARCHAR(16) REFERENCES flowcell (fc_id)</span><span class="se">\</span>
<a id="__codelineno-12-87" name="__codelineno-12-87"></a><span class="s2">);&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-218">218</a></span>
<span class="normal"><a href="#__codelineno-13-219">219</a></span>
<span class="normal"><a href="#__codelineno-13-220">220</a></span>
<span class="normal"><a href="#__codelineno-13-221">221</a></span>
<span class="normal"><a href="#__codelineno-13-222">222</a></span>
<span class="normal"><a href="#__codelineno-13-223">223</a></span>
<span class="normal"><a href="#__codelineno-13-224">224</a></span>
<span class="normal"><a href="#__codelineno-13-225">225</a></span>
<span class="normal"><a href="#__codelineno-13-226">226</a></span>
<span class="normal"><a href="#__codelineno-13-227">227</a></span>
<span class="normal"><a href="#__codelineno-13-228">228</a></span>
<span class="normal"><a href="#__codelineno-13-229">229</a></span>
<span class="normal"><a href="#__codelineno-13-230">230</a></span>
<span class="normal"><a href="#__codelineno-13-231">231</a></span>
<span class="normal"><a href="#__codelineno-13-232">232</a></span>
<span class="normal"><a href="#__codelineno-13-233">233</a></span>
<span class="normal"><a href="#__codelineno-13-234">234</a></span>
<span class="normal"><a href="#__codelineno-13-235">235</a></span>
<span class="normal"><a href="#__codelineno-13-236">236</a></span>
<span class="normal"><a href="#__codelineno-13-237">237</a></span>
<span class="normal"><a href="#__codelineno-13-238">238</a></span>
<span class="normal"><a href="#__codelineno-13-239">239</a></span>
<span class="normal"><a href="#__codelineno-13-240">240</a></span>
<span class="normal"><a href="#__codelineno-13-241">241</a></span>
<span class="normal"><a href="#__codelineno-13-242">242</a></span>
<span class="normal"><a href="#__codelineno-13-243">243</a></span>
<span class="normal"><a href="#__codelineno-13-244">244</a></span>
<span class="normal"><a href="#__codelineno-13-245">245</a></span>
<span class="normal"><a href="#__codelineno-13-246">246</a></span>
<span class="normal"><a href="#__codelineno-13-247">247</a></span>
<span class="normal"><a href="#__codelineno-13-248">248</a></span>
<span class="normal"><a href="#__codelineno-13-249">249</a></span>
<span class="normal"><a href="#__codelineno-13-250">250</a></span>
<span class="normal"><a href="#__codelineno-13-251">251</a></span>
<span class="normal"><a href="#__codelineno-13-252">252</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-218" name="__codelineno-13-218"></a><span class="c1"># table pools</span>
<a id="__codelineno-13-219" name="__codelineno-13-219"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-13-220" name="__codelineno-13-220"></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO pools (pooling_id, pf_reads, loading_conc, q30, fc_id) VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39;);&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Reads (PF)&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Loading Conc.&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Q30&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">]))</span>
<a id="__codelineno-13-221" name="__codelineno-13-221"></a><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-13-222" name="__codelineno-13-222"></a>    <span class="c1"># print(e)</span>
<a id="__codelineno-13-223" name="__codelineno-13-223"></a>    <span class="c1"># print(&quot;pools data already exists; checking for data integrity...&quot;)</span>
<a id="__codelineno-13-224" name="__codelineno-13-224"></a>    <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT pf_reads, loading_conc, q30, fc_id FROM pools WHERE pooling_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">]))</span> <span class="c1"># try except data integrity</span>
<a id="__codelineno-13-225" name="__codelineno-13-225"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-13-226" name="__codelineno-13-226"></a>    <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-13-227" name="__codelineno-13-227"></a>        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-13-228" name="__codelineno-13-228"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Reads (PF)&quot;</span><span class="p">]:</span>
<a id="__codelineno-13-229" name="__codelineno-13-229"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pf_reads data changed for pool &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Reads (PF)&quot;</span><span class="p">]))</span>
<a id="__codelineno-13-230" name="__codelineno-13-230"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Loading Conc.&quot;</span><span class="p">]:</span>
<a id="__codelineno-13-231" name="__codelineno-13-231"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loading_conc data changed for pool &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Loading Conc.&quot;</span><span class="p">]))</span>
<a id="__codelineno-13-232" name="__codelineno-13-232"></a>        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Q30&quot;</span><span class="p">]):</span>
<a id="__codelineno-13-233" name="__codelineno-13-233"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q30 data changed for pool &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Q30&quot;</span><span class="p">]))</span>
<a id="__codelineno-13-234" name="__codelineno-13-234"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">]:</span>
<a id="__codelineno-13-235" name="__codelineno-13-235"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fc_id data changed for pool &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">]))</span>
<a id="__codelineno-13-236" name="__codelineno-13-236"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-237" name="__codelineno-13-237"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pool data fetch failed&quot;</span><span class="p">)</span>
<a id="__codelineno-13-238" name="__codelineno-13-238"></a>
<a id="__codelineno-13-239" name="__codelineno-13-239"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT lane_1, lane_2, lane_3, lane_4 FROM pools where pooling_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-13-240" name="__codelineno-13-240"></a><span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-13-241" name="__codelineno-13-241"></a><span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-13-242" name="__codelineno-13-242"></a>    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-13-243" name="__codelineno-13-243"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Lane&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;L1&quot;</span><span class="p">:</span>
<a id="__codelineno-13-244" name="__codelineno-13-244"></a>        <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE pools SET lane_1 = TRUE WHERE pooling_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-13-245" name="__codelineno-13-245"></a>    <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Lane&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;L2&quot;</span><span class="p">:</span>
<a id="__codelineno-13-246" name="__codelineno-13-246"></a>        <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE pools SET lane_2 = TRUE WHERE pooling_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-13-247" name="__codelineno-13-247"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Lane&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;L3&quot;</span><span class="p">:</span>
<a id="__codelineno-13-248" name="__codelineno-13-248"></a>        <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE pools SET lane_3 = TRUE WHERE pooling_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-13-249" name="__codelineno-13-249"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Lane&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;L4&quot;</span><span class="p">:</span>
<a id="__codelineno-13-250" name="__codelineno-13-250"></a>        <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE pools SET lane_4 = TRUE WHERE pooling_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-13-251" name="__codelineno-13-251"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-252" name="__codelineno-13-252"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pool lane data fetch failed&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h3 id="custom-type-status">Custom Type: <code>status</code></h3>
<p>This custom type defines the possible statuses for a sample, indicating whether the sample is new, a top-up of a previous sample, or a repeat.
The <code>status</code> type is used in the <code>samples</code> table. </p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">createDB.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-89">89</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-89" name="__codelineno-14-89"></a><span class="n">CREATE</span> <span class="n">TYPE</span> <span class="n">status</span> <span class="n">AS</span> <span class="n">ENUM</span> <span class="p">(</span><span class="s1">&#39;New&#39;</span><span class="p">,</span> <span class="s1">&#39;Top-up&#39;</span><span class="p">,</span> <span class="s1">&#39;Repeat&#39;</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h3 id="table-8-samples">Table 8: <code>samples</code></h3>
<p>This table contains detailed information about individual samples, including the associated pooling and flowcell information, quality control metrics, and various metadata related to the sequencing process.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:3"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><input id="__tabbed_9_3" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">Schema</label><label for="__tabbed_9_2">createDB.py</label><label for="__tabbed_9_3">insertDB.py</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Data Type</th>
<th>Constraints</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sample_id</td>
<td>VARCHAR(10)</td>
<td>NOT NULL, CHECK (char_length(sample_id) = 10)</td>
<td>Unique identifier for sample</td>
</tr>
<tr>
<td>pooling_id</td>
<td>VARCHAR(32)</td>
<td>REFERENCES pools (pooling_id)</td>
<td>Linked pooling ID</td>
</tr>
<tr>
<td>fc_id</td>
<td>VARCHAR(16)</td>
<td>REFERENCES flowcell (fc_id)</td>
<td>Linked flowcell ID</td>
</tr>
<tr>
<td>sample_name</td>
<td>VARCHAR(64)</td>
<td>NOT NULL</td>
<td>Human-readable name of the sample</td>
</tr>
<tr>
<td>submission_id</td>
<td>VARCHAR(64)</td>
<td>REFERENCES submissions (submission_id)</td>
<td>Linked submission ID</td>
</tr>
<tr>
<td>qpcr</td>
<td>NUMERIC(4, 2)</td>
<td>CHECK ((qpcr ISNULL) OR (qpcr &gt;= 0)) DEFAULT NULL</td>
<td>QPCR concentration of the sample</td>
</tr>
<tr>
<td>fragment</td>
<td>SMALLINT</td>
<td>NOT NULL, CHECK (fragment &gt;= 0)</td>
<td>Fragment size of the library in base pairs</td>
</tr>
<tr>
<td>labchip_conc</td>
<td>NUMERIC(5, 2)</td>
<td>CHECK ((labchip_conc ISNULL) OR (labchip_conc &gt;= 0)) DEFAULT NULL</td>
<td>Concentration measured by LabChip</td>
</tr>
<tr>
<td>well</td>
<td>VARCHAR(32)</td>
<td>NOT NULL, CHECK (char_length(well) &gt; 0)</td>
<td>Well position in the plate where the sample is located</td>
</tr>
<tr>
<td>pre_norm_well</td>
<td>VARCHAR(32)</td>
<td>DEFAULT '_'</td>
<td>Well position before normalization</td>
</tr>
<tr>
<td>i5_id</td>
<td>VARCHAR(16)</td>
<td>REFERENCES i5 (i5_id)</td>
<td>Linked i5 index ID</td>
</tr>
<tr>
<td>i7_id</td>
<td>VARCHAR(16)</td>
<td>REFERENCES i7 (i7_id)</td>
<td>Linked i7 index ID</td>
</tr>
<tr>
<td>data_sample</td>
<td>status</td>
<td>NOT NULL</td>
<td>Status of the sample (New, Top-up, Repeat)</td>
</tr>
<tr>
<td>urgent</td>
<td>BOOLEAN</td>
<td>NOT NULL, DEFAULT FALSE</td>
<td>Flag indicating whether the sample is marked as urgent</td>
</tr>
<tr>
<td>remark</td>
<td>text</td>
<td>DEFAULT '_'</td>
<td>Additional remarks or notes about the sample</td>
</tr>
<tr>
<td>lib_received</td>
<td>DATE</td>
<td>NOT NULL, CHECK (lib_received &lt;= current_date)</td>
<td>Date when the library was received for sequencing</td>
</tr>
<tr>
<td>sample_qc</td>
<td>BOOLEAN</td>
<td>NOT NULL, DEFAULT FALSE</td>
<td>Quality control status of the sample</td>
</tr>
<tr>
<td>lib_qc</td>
<td>BOOLEAN</td>
<td>NOT NULL, DEFAULT FALSE</td>
<td>Quality control status of the library</td>
</tr>
<tr>
<td>error</td>
<td>VARCHAR(64)</td>
<td>NOT NULL, DEFAULT '_'</td>
<td>Details of any errors associated with the sample</td>
</tr>
<tr>
<td>stage_date</td>
<td>DATE</td>
<td>DEFAULT NULL, CHECK (stage_date &lt;= current_date)</td>
<td>Date when the sample data was staged for analysis</td>
</tr>
<tr>
<td>merged</td>
<td>BOOLEAN</td>
<td>DEFAULT FALSE</td>
<td>Flag indicating whether the sample data was merged from multiple lanes</td>
</tr>
<tr>
<td>lane</td>
<td>BOOLEAN</td>
<td>DEFAULT FALSE</td>
<td>Flag indicating whether the sample was run in a dedicated lane</td>
</tr>
<tr>
<td>PRIMARY KEY</td>
<td>-</td>
<td>(sample_id, fc_id)</td>
<td>Composite primary key based on sample ID and flowcell ID</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-15-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-15-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-15-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-15-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-15-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-15-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-15-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-15-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-15-100">100</a></span>
<span class="normal"><a href="#__codelineno-15-101">101</a></span>
<span class="normal"><a href="#__codelineno-15-102">102</a></span>
<span class="normal"><a href="#__codelineno-15-103">103</a></span>
<span class="normal"><a href="#__codelineno-15-104">104</a></span>
<span class="normal"><a href="#__codelineno-15-105">105</a></span>
<span class="normal"><a href="#__codelineno-15-106">106</a></span>
<span class="normal"><a href="#__codelineno-15-107">107</a></span>
<span class="normal"><a href="#__codelineno-15-108">108</a></span>
<span class="normal"><a href="#__codelineno-15-109">109</a></span>
<span class="normal"><a href="#__codelineno-15-110">110</a></span>
<span class="normal"><a href="#__codelineno-15-111">111</a></span>
<span class="normal"><a href="#__codelineno-15-112">112</a></span>
<span class="normal"><a href="#__codelineno-15-113">113</a></span>
<span class="normal"><a href="#__codelineno-15-114">114</a></span>
<span class="normal"><a href="#__codelineno-15-115">115</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-91" name="__codelineno-15-91"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE samples (</span><span class="se">\</span>
<a id="__codelineno-15-92" name="__codelineno-15-92"></a><span class="s2">      sample_id       VARCHAR(10) NOT NULL CHECK (char_length(sample_id) = 10),</span><span class="se">\</span>
<a id="__codelineno-15-93" name="__codelineno-15-93"></a><span class="s2">      pooling_id      VARCHAR(32) REFERENCES pools (pooling_id),</span><span class="se">\</span>
<a id="__codelineno-15-94" name="__codelineno-15-94"></a><span class="s2">      fc_id           VARCHAR(16) REFERENCES flowcell (fc_id),</span><span class="se">\</span>
<a id="__codelineno-15-95" name="__codelineno-15-95"></a><span class="s2">      sample_name     VARCHAR(64) NOT NULL,</span><span class="se">\</span>
<a id="__codelineno-15-96" name="__codelineno-15-96"></a><span class="s2">      submission_id   VARCHAR(64) REFERENCES submissions (submission_id),</span><span class="se">\</span>
<a id="__codelineno-15-97" name="__codelineno-15-97"></a><span class="s2">      qpcr            NUMERIC(4, 2) CHECK ((qpcr ISNULL) OR (qpcr &gt;= 0)) DEFAULT NULL,</span><span class="se">\</span>
<a id="__codelineno-15-98" name="__codelineno-15-98"></a><span class="s2">      fragment        SMALLINT NOT NULL CHECK (fragment &gt;= 0),</span><span class="se">\</span>
<a id="__codelineno-15-99" name="__codelineno-15-99"></a><span class="s2">      labchip_conc    NUMERIC(5, 2) CHECK ((labchip_conc ISNULL) OR (labchip_conc &gt;= 0)) DEFAULT NULL,</span><span class="se">\</span>
<a id="__codelineno-15-100" name="__codelineno-15-100"></a><span class="s2">      well            VARCHAR(32) NOT NULL CHECK (char_length(well) &gt; 0),</span><span class="se">\</span>
<a id="__codelineno-15-101" name="__codelineno-15-101"></a><span class="s2">      pre_norm_well   VARCHAR(32) DEFAULT &#39;_&#39;,</span><span class="se">\</span>
<a id="__codelineno-15-102" name="__codelineno-15-102"></a><span class="s2">      i5_id           VARCHAR(16) REFERENCES i5 (i5_id),</span><span class="se">\</span>
<a id="__codelineno-15-103" name="__codelineno-15-103"></a><span class="s2">      i7_id           VARCHAR(16) REFERENCES i7 (i7_id),</span><span class="se">\</span>
<a id="__codelineno-15-104" name="__codelineno-15-104"></a><span class="s2">      data_sample     status NOT NULL,</span><span class="se">\</span>
<a id="__codelineno-15-105" name="__codelineno-15-105"></a><span class="s2">      urgent          BOOLEAN NOT NULL DEFAULT FALSE,</span><span class="se">\</span>
<a id="__codelineno-15-106" name="__codelineno-15-106"></a><span class="s2">      remark          text DEFAULT &#39;_&#39;,</span><span class="se">\</span>
<a id="__codelineno-15-107" name="__codelineno-15-107"></a><span class="s2">      lib_received    DATE NOT NULL CHECK (lib_received &lt;= current_date),</span><span class="se">\</span>
<a id="__codelineno-15-108" name="__codelineno-15-108"></a><span class="s2">      sample_qc       BOOLEAN NOT NULL DEFAULT FALSE,</span><span class="se">\</span>
<a id="__codelineno-15-109" name="__codelineno-15-109"></a><span class="s2">      lib_qc          BOOLEAN NOT NULL DEFAULT FALSE,</span><span class="se">\</span>
<a id="__codelineno-15-110" name="__codelineno-15-110"></a><span class="s2">      error           VARCHAR(64) NOT NULL DEFAULT &#39;_&#39;,</span><span class="se">\</span>
<a id="__codelineno-15-111" name="__codelineno-15-111"></a><span class="s2">      stage_date       DATE    DEFAULT NULL CHECK (stage_date &lt;= current_date),</span><span class="se">\</span>
<a id="__codelineno-15-112" name="__codelineno-15-112"></a><span class="s2">      merged          BOOLEAN DEFAULT FALSE,</span><span class="se">\</span>
<a id="__codelineno-15-113" name="__codelineno-15-113"></a><span class="s2">      lane            BOOLEAN DEFAULT FALSE,</span><span class="se">\</span>
<a id="__codelineno-15-114" name="__codelineno-15-114"></a><span class="s2">      PRIMARY KEY (sample_id, fc_id)</span><span class="se">\</span>
<a id="__codelineno-15-115" name="__codelineno-15-115"></a><span class="s2">  );&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-254">254</a></span>
<span class="normal"><a href="#__codelineno-16-255">255</a></span>
<span class="normal"><a href="#__codelineno-16-256">256</a></span>
<span class="normal"><a href="#__codelineno-16-257">257</a></span>
<span class="normal"><a href="#__codelineno-16-258">258</a></span>
<span class="normal"><a href="#__codelineno-16-259">259</a></span>
<span class="normal"><a href="#__codelineno-16-260">260</a></span>
<span class="normal"><a href="#__codelineno-16-261">261</a></span>
<span class="normal"><a href="#__codelineno-16-262">262</a></span>
<span class="normal"><a href="#__codelineno-16-263">263</a></span>
<span class="normal"><a href="#__codelineno-16-264">264</a></span>
<span class="normal"><a href="#__codelineno-16-265">265</a></span>
<span class="normal"><a href="#__codelineno-16-266">266</a></span>
<span class="normal"><a href="#__codelineno-16-267">267</a></span>
<span class="normal"><a href="#__codelineno-16-268">268</a></span>
<span class="normal"><a href="#__codelineno-16-269">269</a></span>
<span class="normal"><a href="#__codelineno-16-270">270</a></span>
<span class="normal"><a href="#__codelineno-16-271">271</a></span>
<span class="normal"><a href="#__codelineno-16-272">272</a></span>
<span class="normal"><a href="#__codelineno-16-273">273</a></span>
<span class="normal"><a href="#__codelineno-16-274">274</a></span>
<span class="normal"><a href="#__codelineno-16-275">275</a></span>
<span class="normal"><a href="#__codelineno-16-276">276</a></span>
<span class="normal"><a href="#__codelineno-16-277">277</a></span>
<span class="normal"><a href="#__codelineno-16-278">278</a></span>
<span class="normal"><a href="#__codelineno-16-279">279</a></span>
<span class="normal"><a href="#__codelineno-16-280">280</a></span>
<span class="normal"><a href="#__codelineno-16-281">281</a></span>
<span class="normal"><a href="#__codelineno-16-282">282</a></span>
<span class="normal"><a href="#__codelineno-16-283">283</a></span>
<span class="normal"><a href="#__codelineno-16-284">284</a></span>
<span class="normal"><a href="#__codelineno-16-285">285</a></span>
<span class="normal"><a href="#__codelineno-16-286">286</a></span>
<span class="normal"><a href="#__codelineno-16-287">287</a></span>
<span class="normal"><a href="#__codelineno-16-288">288</a></span>
<span class="normal"><a href="#__codelineno-16-289">289</a></span>
<span class="normal"><a href="#__codelineno-16-290">290</a></span>
<span class="normal"><a href="#__codelineno-16-291">291</a></span>
<span class="normal"><a href="#__codelineno-16-292">292</a></span>
<span class="normal"><a href="#__codelineno-16-293">293</a></span>
<span class="normal"><a href="#__codelineno-16-294">294</a></span>
<span class="normal"><a href="#__codelineno-16-295">295</a></span>
<span class="normal"><a href="#__codelineno-16-296">296</a></span>
<span class="normal"><a href="#__codelineno-16-297">297</a></span>
<span class="normal"><a href="#__codelineno-16-298">298</a></span>
<span class="normal"><a href="#__codelineno-16-299">299</a></span>
<span class="normal"><a href="#__codelineno-16-300">300</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-254" name="__codelineno-16-254"></a><span class="c1"># table samples</span>
<a id="__codelineno-16-255" name="__codelineno-16-255"></a><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT pooling_id, sample_name, submission_id, qpcr, fragment, labchip_conc, well, pre_norm_well, i5_id, i7_id, data_sample, urgent, remark, lib_received, sample_qc, lib_qc</span><span class="se">\</span>
<a id="__codelineno-16-256" name="__codelineno-16-256"></a><span class="s2"> FROM samples WHERE sample_id = &#39;</span><span class="si">%s</span><span class="s2">&#39; AND fc_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-257" name="__codelineno-16-257"></a><span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-16-258" name="__codelineno-16-258"></a><span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-16-259" name="__codelineno-16-259"></a>    <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;INSERT INTO samples (sample_id, pooling_id, fc_id, sample_name, submission_id, fragment, well, pre_norm_well, i5_id, i7_id, data_sample, urgent, remark, lib_received, sample_qc, lib_qc)</span><span class="se">\</span>
<a id="__codelineno-16-260" name="__codelineno-16-260"></a><span class="s2">    VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;,&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;</span><span class="si">%s</span><span class="s2">&#39; );&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Original Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Fragment size (bp)&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Well&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pre-Norm Well&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I5_ID&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I7_ID&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Data_Sample_Status&quot;</span><span class="p">],</span>
<a id="__codelineno-16-261" name="__codelineno-16-261"></a>                                                                                                     <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Urgency&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Remark&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Libaries and info received date&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample QC P/F&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Lib QC P/F&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-262" name="__codelineno-16-262"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-16-263" name="__codelineno-16-263"></a>    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-16-264" name="__codelineno-16-264"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-265" name="__codelineno-16-265"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pooling ID data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pooling ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-266" name="__codelineno-16-266"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Original Sample Name&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-267" name="__codelineno-16-267"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original Sample Name data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Original Sample Name&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-268" name="__codelineno-16-268"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-269" name="__codelineno-16-269"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Submission ID data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Submission ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-270" name="__codelineno-16-270"></a>    <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;QPCR Conc. (nM) / iseq output&quot;</span><span class="p">]):</span>
<a id="__codelineno-16-271" name="__codelineno-16-271"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;QPCR Conc. (nM) / iseq output data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;QPCR Conc. (nM) / iseq output&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-272" name="__codelineno-16-272"></a>    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Fragment size (bp)&quot;</span><span class="p">]):</span>
<a id="__codelineno-16-273" name="__codelineno-16-273"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fragment size (bp) data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Fragment size (bp)&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-274" name="__codelineno-16-274"></a>    <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;LabChip/Bioanalyzer Conc. (nM)&quot;</span><span class="p">]):</span>
<a id="__codelineno-16-275" name="__codelineno-16-275"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LabChip/Bioanalyzer Conc. (nM) data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;LabChip/Bioanalyzer Conc. (nM)&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-276" name="__codelineno-16-276"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Well&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-277" name="__codelineno-16-277"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Well data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Well&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-278" name="__codelineno-16-278"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pre-Norm Well&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-279" name="__codelineno-16-279"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pre-Norm Well data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Pre-Norm Well&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-280" name="__codelineno-16-280"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I5_ID&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-281" name="__codelineno-16-281"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INDEX_i5_ID data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_i5_ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-282" name="__codelineno-16-282"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_I7_ID&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-283" name="__codelineno-16-283"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INDEX_i7_ID data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;INDEX_i7_ID&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-284" name="__codelineno-16-284"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Data_Sample_Status&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-285" name="__codelineno-16-285"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data_Sample_status data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Data_Sample_status&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-286" name="__codelineno-16-286"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Urgency&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-287" name="__codelineno-16-287"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Urgency data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Urgency&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-288" name="__codelineno-16-288"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Remark&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-289" name="__codelineno-16-289"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remark data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Remark&quot;</span><span class="p">]))</span>        
<a id="__codelineno-16-290" name="__codelineno-16-290"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">!=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Libaries and info received date&quot;</span><span class="p">],</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">():</span>
<a id="__codelineno-16-291" name="__codelineno-16-291"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Libaries and info received date data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Libaries and info received date&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-292" name="__codelineno-16-292"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample QC P/F&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-293" name="__codelineno-16-293"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sample QC P/F data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample QC P/F&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-294" name="__codelineno-16-294"></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">!=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Lib QC P/F&quot;</span><span class="p">]:</span>
<a id="__codelineno-16-295" name="__codelineno-16-295"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lib QC P/F data changed for sample &#39;</span><span class="si">%s</span><span class="s2">&#39; and fc &#39;</span><span class="si">%s</span><span class="s2">&#39; from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Lib QC P/F&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-296" name="__codelineno-16-296"></a>
<a id="__codelineno-16-297" name="__codelineno-16-297"></a><span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;QPCR Conc. (nM) / iseq output&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-16-298" name="__codelineno-16-298"></a>    <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE samples SET qpcr = &#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE sample_id = &#39;</span><span class="si">%s</span><span class="s2">&#39; AND fc_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;QPCR Conc. (nM) / iseq output&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">]))</span>
<a id="__codelineno-16-299" name="__codelineno-16-299"></a><span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;LabChip/Bioanalyzer Conc. (nM)&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-16-300" name="__codelineno-16-300"></a>    <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;UPDATE samples SET labchip_conc = &#39;</span><span class="si">%s</span><span class="s2">&#39; WHERE sample_id = &#39;</span><span class="si">%s</span><span class="s2">&#39; AND fc_id = &#39;</span><span class="si">%s</span><span class="s2">&#39;;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;LabChip/Bioanalyzer Conc. (nM)&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sample Name&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FC&quot;</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h3 id="erd">ERD</h3>
<pre class="mermaid"><code>erDiagram
    pi_projects ||--o{ submissions : "1..n"
    pi_projects {
        project_id VARCHAR(32)
        pi VARCHAR(08)
        requirement VARCHAR(32)
        earliest DATE
        latest DATE
    }

    i5 ||--o{ samples : "1..n"
    i5 {
        i5_id VARCHAR(16)
        i5_sequence VARCHAR(10)
    }

    i7 ||--o{ samples : "1..n"
    i7 {
        i7_id VARCHAR(16)
        i7_sequence VARCHAR(10)
    }

    sequencer ||--o{ flowcell : "1..n"
    sequencer {
        sequencer_id VARCHAR(16)
    }

    submissions ||--o{ samples : "1..n"
    submissions {
        submission_id VARCHAR(64)
        project_id VARCHAR(32)
        date DATE
        cov VARCHAR(16)
        srv VARCHAR(16)
        rg VARCHAR(16)
        anl VARCHAR(16)
        datatype VARCHAR(16)
    }

    flowcell ||--o{ pools : "1..n"
    flowcell ||--o{ samples : "1..n"
    flowcell {
        fc_id VARCHAR(16)
        fc_type VARCHAR(16)
        loaded_by VARCHAR(08)
        loading_date DATE
        completion_date DATE
        demultiplex_date DATE
        stage_date DATE
        process_date DATE
        order_no VARCHAR(32)
        sequencer_id VARCHAR(16)
        run_duration SMALLINT
        position BOOLEAN
    }

    pools {
        pooling_id VARCHAR(32)
        pf_reads VARCHAR(08)
        loading_conc VARCHAR(08)
        q30 NUMERIC
        lane_1 BOOLEAN
        lane_2 BOOLEAN
        lane_3 BOOLEAN
        lane_4 BOOLEAN
        fc_id VARCHAR(16)
    }

    samples {
        sample_id VARCHAR(10)
        pooling_id VARCHAR(32)
        fc_id VARCHAR(16)
        sample_name VARCHAR(64)
        submission_id VARCHAR(64)
        qpcr NUMERIC
        fragment SMALLINT
        labchip_conc NUMERIC
        well VARCHAR(32)
        pre_norm_well VARCHAR(32)
        i5_id VARCHAR(16)
        i7_id VARCHAR(16)
        data_sample ENUM
        urgent BOOLEAN
        remark TEXT
        lib_received DATE
        sample_qc BOOLEAN
        lib_qc BOOLEAN
        error VARCHAR(64)
        stage_date DATE
        merged BOOLEAN
        lane BOOLEAN
    }</code></pre>
<h2 id="the-process">The Process</h2>
<p>The PostgreSQL database currently has 35 attributes overall. The directories having the files from which the data is extracted and populated in the database is to be configured during setup in <a href="2.%20setup.html#step-3-configure-the-database">this step</a>. The directories are:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">database/insertDB.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-37">37</a></span>
<span class="normal"><a href="#__codelineno-17-38">38</a></span>
<span class="normal"><a href="#__codelineno-17-39">39</a></span>
<span class="normal"><a href="#__codelineno-17-40">40</a></span>
<span class="normal"><a href="#__codelineno-17-41">41</a></span>
<span class="normal"><a href="#__codelineno-17-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-37" name="__codelineno-17-37"></a>  <span class="c1"># Set up the paths</span>
<a id="__codelineno-17-38" name="__codelineno-17-38"></a>  <span class="n">directory_path</span> <span class="o">=</span> <span class="s2">&quot;./input-data-for-externs/FC multiqc&quot;</span>
<a id="__codelineno-17-39" name="__codelineno-17-39"></a>  <span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;./input-data-for-externs&quot;</span>
<a id="__codelineno-17-40" name="__codelineno-17-40"></a>  <span class="n">fcqc_directory</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;/flowcell-qc-reports&quot;</span>
<a id="__codelineno-17-41" name="__codelineno-17-41"></a>  <span class="n">rawinfo_directory</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;/rawinfo-dirs&quot;</span>
<a id="__codelineno-17-42" name="__codelineno-17-42"></a>  <span class="n">runs_directory</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span> <span class="s2">&quot;/Runs&quot;</span>
</code></pre></div></td></tr></table></div>
<p>The following is a detailed walkthrough of the database population process from the <code>insertDB.py</code> script.</p>
<h3 id="main-function">main Function</h3>
<p>The <code>main</code> function is the entry point of the script. It:</p>
<ol>
<li>Finds all the HTML files in the flowcell subdirectories under <code>flowcell-qc-reports</code> directory. </li>
<li>Extracts the flowcell IDs from these filenames and stores them in a list <code>FC</code>.</li>
</ol>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The date it is found and the path for the corresponding HTML file for every FC is saved in the database.</p>
</div>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-408">408</a></span>
<span class="normal"><a href="#__codelineno-18-409">409</a></span>
<span class="normal"><a href="#__codelineno-18-410">410</a></span>
<span class="normal"><a href="#__codelineno-18-411">411</a></span>
<span class="normal"><a href="#__codelineno-18-412">412</a></span>
<span class="normal"><a href="#__codelineno-18-413">413</a></span>
<span class="normal"><a href="#__codelineno-18-414">414</a></span>
<span class="normal"><a href="#__codelineno-18-415">415</a></span>
<span class="normal"><a href="#__codelineno-18-416">416</a></span>
<span class="normal"><a href="#__codelineno-18-417">417</a></span>
<span class="normal"><a href="#__codelineno-18-418">418</a></span>
<span class="normal"><a href="#__codelineno-18-419">419</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-408" name="__codelineno-18-408"></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-18-409" name="__codelineno-18-409"></a>    <span class="n">FC</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-18-410" name="__codelineno-18-410"></a>    <span class="n">subdirectories</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">fcqc_directory</span><span class="p">)</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()]</span>
<a id="__codelineno-18-411" name="__codelineno-18-411"></a>
<a id="__codelineno-18-412" name="__codelineno-18-412"></a>    <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">subdirectories</span><span class="p">:</span>
<a id="__codelineno-18-413" name="__codelineno-18-413"></a>        <span class="n">subdir</span> <span class="o">=</span> <span class="n">fcqc_directory</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">dir</span>
<a id="__codelineno-18-414" name="__codelineno-18-414"></a>        <span class="n">html_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span> <span class="s2">&quot;*.html&quot;</span><span class="p">))</span>
<a id="__codelineno-18-415" name="__codelineno-18-415"></a>        <span class="k">if</span> <span class="n">html_files</span><span class="p">:</span>
<a id="__codelineno-18-416" name="__codelineno-18-416"></a>            <span class="k">for</span> <span class="n">html_file_path</span> <span class="ow">in</span> <span class="n">html_files</span><span class="p">:</span>
<a id="__codelineno-18-417" name="__codelineno-18-417"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="s2">&quot; : Found HTML file generated for .&quot;</span><span class="p">,</span> <span class="n">html_file_path</span><span class="p">)</span>
<a id="__codelineno-18-418" name="__codelineno-18-418"></a>                <span class="n">fc</span> <span class="o">=</span> <span class="n">html_file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-18-419" name="__codelineno-18-419"></a>                <span class="n">FC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
3. Queries the database to find which of these flowcells have already been demultiplexed and stores their IDs in a set <code>demultiplexed_FC</code>.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-421">421</a></span>
<span class="normal"><a href="#__codelineno-19-422">422</a></span>
<span class="normal"><a href="#__codelineno-19-423">423</a></span>
<span class="normal"><a href="#__codelineno-19-424">424</a></span>
<span class="normal"><a href="#__codelineno-19-425">425</a></span>
<span class="normal"><a href="#__codelineno-19-426">426</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-421" name="__codelineno-19-421"></a>    <span class="n">sql</span><span class="p">(</span><span class="s2">&quot;SELECT fc_id FROM flowcell;&quot;</span><span class="p">)</span>
<a id="__codelineno-19-422" name="__codelineno-19-422"></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-19-423" name="__codelineno-19-423"></a>
<a id="__codelineno-19-424" name="__codelineno-19-424"></a>    <span class="n">demultiplexed_FC</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-19-425" name="__codelineno-19-425"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<a id="__codelineno-19-426" name="__codelineno-19-426"></a>        <span class="n">demultiplexed_FC</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
4. For each flowcell ID in <code>FC</code> that is not in <code>demultiplexed_FC</code>, calls the <code>store_fc</code> function to process and store the data for that flowcell.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-428">428</a></span>
<span class="normal"><a href="#__codelineno-20-429">429</a></span>
<span class="normal"><a href="#__codelineno-20-430">430</a></span>
<span class="normal"><a href="#__codelineno-20-431">431</a></span>
<span class="normal"><a href="#__codelineno-20-432">432</a></span>
<span class="normal"><a href="#__codelineno-20-433">433</a></span>
<span class="normal"><a href="#__codelineno-20-434">434</a></span>
<span class="normal"><a href="#__codelineno-20-435">435</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-428" name="__codelineno-20-428"></a>    <span class="k">for</span> <span class="n">fc</span> <span class="ow">in</span> <span class="n">FC</span><span class="p">:</span>
<a id="__codelineno-20-429" name="__codelineno-20-429"></a>        <span class="k">if</span> <span class="n">fc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">demultiplexed_FC</span><span class="p">:</span>
<a id="__codelineno-20-430" name="__codelineno-20-430"></a>            <span class="n">store_fc</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span>
<a id="__codelineno-20-431" name="__codelineno-20-431"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="s2">&quot; : Data stored in the database for fc&quot;</span> <span class="o">+</span> <span class="n">fc</span><span class="p">)</span>
<a id="__codelineno-20-432" name="__codelineno-20-432"></a>
<a id="__codelineno-20-433" name="__codelineno-20-433"></a>    <span class="k">return</span> <span class="mi">0</span>
<a id="__codelineno-20-434" name="__codelineno-20-434"></a>
<a id="__codelineno-20-435" name="__codelineno-20-435"></a><span class="n">main</span><span class="p">()</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="store_fc-function">store_fc Function</h3>
<p>The <code>store_fc</code> function is the core of the script. It processes data related to a specific flowcell (<code>fc</code>). For each flowcell, it:
1. Finds the corresponding raw information file from a directory of raw information files.
2. Reads and processes the data from this file.
3. Constructs a dictionary (<code>row</code>) for each line in the file, where the keys are field names and the values are the data for those fields.
4. Modifies and cleans this data as necessary (e.g., parsing dates, converting strings to booleans, etc.).
5. Calls the <code>store_row</code> function (not shown in the script) to insert this processed data into the appropriate tables in the database.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">def</span> <span class="nf">store_fc</span><span class="p">(</span><span class="n">fc</span><span class="p">):</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>    <span class="o">...</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_info_file</span><span class="p">:</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>        <span class="n">row</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>        <span class="o">...</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>        <span class="n">store_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</code></pre></div>
<h2 id="the-process_1">The Process:</h2>
<ol>
<li>
<p><strong>Connecting to the Database</strong>: The script starts by establishing a connection to the PostgreSQL database and creating a cursor object to interact with the database.</p>
</li>
<li>
<p><strong>Reading and Processing Files</strong>: For each flowcell, the script reads the corresponding raw information file, processes this data, and constructs a dictionary for each line in the file.</p>
</li>
<li>
<p><strong>Data Cleaning and Transformation</strong>: The script performs various data cleaning and transformation tasks, such as parsing dates, converting strings to booleans, and renaming, adding, or removing fields as necessary.</p>
</li>
<li>
<p><strong>Storing Data in the Database</strong>: After processing the data for each flowcell, the script calls a separate <code>store_row</code> function to insert this data into the appropriate tables in the database.</p>
</li>
<li>
<p><strong>Checking for Existing Data</strong>: Before inserting data for a flowcell, the script checks whether data for that flowcell has already been demultiplexed and stored in the database. If so, it skips that flowcell to avoid duplicate data.</p>
</li>
<li>
<p><strong>Logging and Error Handling</strong>: Throughout the script, there are print statements that log the progress of the script, and exception handling that prints errors when SQL commands fail to execute.</p>
</li>
</ol>
<p>This script is designed to be run periodically to update the database with new data as new flowcells are processed and new raw information files are generated.</p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="2.%20setup.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Setup" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Setup
              </div>
            </div>
          </a>
        
        
          
          <a href="4.%20flask_api.html" class="md-footer__link md-footer__link--next" aria-label="Next: Flask API Documentation" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Flask API Documentation
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2023 <a href="https://www.linkedin.com/in/deep-chandra/"  target="_blank" rel="noopener">Deep Chandra</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.path", "navigation.footer", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.tabs.link", "content.code.annotate", "content.code.copy"], "search": "assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>